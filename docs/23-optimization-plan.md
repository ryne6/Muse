# 项目优化与完善计划

## 当前项目分析

### 已完成功能 ✅
- 对话管理系统
- AI 集成（Claude + OpenAI）
- Tool Calls UI（前端）
- 文件浏览器
- Markdown 渲染
- 自定义模型配置

### 发现的问题 🐛

#### 1. 用户体验问题
- ❌ 使用 `alert()` 显示错误（不够友好）
- ❌ 无加载状态指示器
- ❌ 缺少快捷键支持
- ❌ 首次使用无引导

#### 2. 功能不完整
- ❌ Tool Calls UI 没有实际数据（后端已实现，未集成）
- ❌ 文件浏览器无搜索功能
- ❌ 文件无预览功能
- ❌ 无复制路径功能

#### 3. 代码质量
- ❌ 缺少错误边界（Error Boundary）
- ❌ 部分组件可以拆分更细
- ❌ 缺少单元测试
- ❌ 部分重复代码

#### 4. 性能问题
- ❌ 无虚拟滚动（大型项目）
- ❌ 缺少 React.memo 优化
- ❌ 无防抖/节流

---

## 优化计划（按优先级）

### 🔥 高优先级（立即执行）

#### Phase 1: Toast 通知系统 (1小时)
**问题**: 当前使用 `alert()` 显示错误，体验差
**目标**: 实现优雅的 Toast 通知

**任务**:
1. 安装 `sonner` 或 `react-hot-toast`
2. 创建 Toast 组件
3. 替换所有 alert() 调用
4. 添加不同类型的提示（success/error/info/loading）

#### Phase 2: 工具调用集成 (2-3小时)
**问题**: Tool Calls UI 已完成但无数据显示
**目标**: 让 AI 工具调用真正显示在界面上

**任务**:
1. 更新 chatStore.sendMessage() 捕获工具调用事件
2. 更新 ClaudeProvider 流式响应处理
3. 将 toolCalls 和 toolResults 保存到 message
4. 测试工具调用显示

#### Phase 3: 加载状态优化 (1-2小时)
**问题**: 用户不知道系统在做什么
**目标**: 添加清晰的加载指示器

**任务**:
1. 消息发送中显示 loading skeleton
2. 文件浏览器刷新时显示 spinner
3. AI 思考时显示 typing indicator
4. 添加进度条（长时间操作）

---

### ⭐ 中优先级（后续优化）

#### Phase 4: 文件搜索功能 (2小时)
**问题**: 大型项目中找文件困难
**目标**: 快速搜索文件

**任务**:
1. 在 FileExplorer 添加搜索框
2. 实现文件名模糊搜索
3. 高亮匹配结果
4. 支持快捷键 Cmd+P

#### Phase 5: 快捷键系统 (2小时)
**问题**: 鼠标操作效率低
**目标**: 常用操作支持快捷键

**任务**:
1. 安装 `react-hotkeys-hook`
2. 实现全局快捷键
   - Cmd/Ctrl + N: 新建对话
   - Cmd/Ctrl + K: 搜索对话
   - Cmd/Ctrl + /: 聚焦输入
   - Cmd/Ctrl + ,: 打开设置
   - Esc: 关闭对话框
3. 快捷键提示 UI

#### Phase 6: 文件预览 (2-3小时)
**问题**: 点击文件无反馈
**目标**: 点击文件显示预览

**任务**:
1. 创建 FilePreview 组件
2. 支持文本文件预览
3. 支持图片预览
4. 支持代码高亮
5. 添加关闭按钮

---

### 📦 低优先级（时间允许）

#### Phase 7: 代码重构 (2-3小时)
**目标**: 提升代码质量和可维护性

**任务**:
1. 提取重复逻辑到 hooks
2. 添加 React.memo 优化重渲染
3. 拆分大型组件
4. 统一命名规范
5. 添加 JSDoc 注释

#### Phase 8: 错误处理 (1-2小时)
**目标**: 提升系统稳定性

**任务**:
1. 添加 Error Boundary
2. 统一错误处理逻辑
3. 添加错误日志
4. 网络错误重试

#### Phase 9: 首次使用体验 (1-2小时)
**目标**: 降低新用户上手门槛

**任务**:
1. 创建欢迎页面
2. API Key 配置引导
3. 工作区选择引导
4. 功能介绍 tooltip

---

## 执行顺序

### 今日剩余时间（估计 3-4小时）
1. **Phase 1: Toast 通知系统** (1h)
   - 替换 alert()
   - 改善错误提示体验

2. **Phase 2: 工具调用集成** (2-3h)
   - 让 Tool Calls UI 真正工作
   - 核心功能完整性提升

### 明天（全天）
3. **Phase 3: 加载状态优化** (1-2h)
4. **Phase 4: 文件搜索功能** (2h)
5. **Phase 5: 快捷键系统** (2h)
6. **Phase 6: 文件预览** (2-3h)

### 后续（根据时间）
7. Phase 7: 代码重构
8. Phase 8: 错误处理
9. Phase 9: 首次使用体验

---

## 技术选型

### Toast 通知
**选择**: `sonner`
**原因**:
- 轻量级（2KB）
- 现代化 UI
- TypeScript 支持
- 易于使用

### 快捷键
**选择**: `react-hotkeys-hook`
**原因**:
- React Hooks API
- 跨平台支持
- 简单易用

### 文件预览
**选择**: 自建组件 + `react-syntax-highlighter`
**原因**:
- 已有依赖
- 灵活可控

---

## 成功指标

### Phase 1 完成标准
- ✅ 所有 alert() 替换为 Toast
- ✅ 支持 4 种类型（success/error/info/loading）
- ✅ 动画流畅

### Phase 2 完成标准
- ✅ AI 调用工具时 UI 显示
- ✅ 显示工具名称、参数、结果
- ✅ 状态正确（pending/success/error）

### Phase 3 完成标准
- ✅ 所有异步操作有加载指示
- ✅ Skeleton loading 显示
- ✅ Typing indicator 显示

---

## 风险评估

### 技术风险
- 🟡 工具调用集成可能需要调试（中等）
- 🟢 Toast 实现简单（低）
- 🟢 加载状态直接（低）

### 时间风险
- Phase 2 可能超时（需要仔细测试）
- 其他 Phase 时间估计较准

---

## 开始执行

现在开始执行 **Phase 1: Toast 通知系统**！
